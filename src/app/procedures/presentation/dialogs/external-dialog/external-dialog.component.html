<h2 mat-dialog-title>{{ data ? "Edicion" : "Creacion" }} Tramite Externo</h2>
<mat-dialog-content>
  <mat-stepper #stepper>
    <mat-step [stepControl]="formProcedure" label="Detalles Tramite">
      <form [formGroup]="formProcedure" class="py-2">
        <div class="grid grid-cols-4 gap-x-2 gap-y-1">
          @if (!data) {
          <div>
            <select-search
              title="Segmento"
              [items]="segments()"
              (onSelect)="selectSegment($event)"
            />
          </div>
          <div class="col-span-3">
            <select-search
              title="Tipo de tramite"
              [items]="typesProcedures()"
              (onSelect)="selectTypeProcedure($event)"
            />
          </div>
          }
          <div class="col-span-4">
            <mat-form-field>
              <mat-label>Referencia del tramite</mat-label>
              <textarea matInput formControlName="reference"></textarea>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Cant. Hojas / Anexos</mat-label>
              <input type="text" matInput formControlName="numberOfDocuments" />
            </mat-form-field>
          </div>
          <div>
            <mat-form-field>
              <mat-label>CITE</mat-label>
              <input type="text" matInput formControlName="cite" />
            </mat-form-field>
          </div>
        </div>
      </form>
      @if(formProcedure.get('type')?.value ){
      <ol class="overflow-y-scroll max-h-72 divide-y-2 border rounded-xl">
        @for (requirement of requirements(); track $index) {
        <li class="p-2 px-4">
          <mat-checkbox [(ngModel)]="requirement.isSelected">
            <p class="ml-2 text-justify">{{ requirement.name }}</p>
          </mat-checkbox>
        </li>
        }
      </ol>
      }
      <div class="flex justify-end">
        <button mat-button matStepperNext>Siguiente</button>
      </div>
    </mat-step>
    <mat-step [stepControl]="formApplicant()" label="Detalles Solicitante">
      <div class="flex py-2 gap-x-4">
        <div>
          <mat-form-field>
            <mat-label>Tipo de solicitante</mat-label>
            <mat-select [(ngModel)]="applicantType">
              <mat-option [value]="'NATURAL'"> NATURAL</mat-option>
              <mat-option [value]="'JURIDICO'"> JURIDICO</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <mat-checkbox [(ngModel)]="hasRepresentative">
            Representante
          </mat-checkbox>
        </div>
      </div>
      @if(!data){ }
      <form [formGroup]="formApplicant()">
        <div class="grid grid-cols-3 gap-x-2">
          @if(applicantType()==="NATURAL"){
          <mat-form-field>
            <mat-label>Nombres</mat-label>
            <input matInput formControlName="firstname" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Apellido paterno</mat-label>
            <input matInput formControlName="middlename" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Apellido materno</mat-label>
            <input matInput formControlName="lastname" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>DNI</mat-label>
            <input matInput formControlName="dni" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Telefono</mat-label>
            <input matInput formControlName="phone" />
          </mat-form-field>
          } @else {
          <div class="col-span-2">
            <mat-form-field>
              <mat-label>Nombres</mat-label>
              <input matInput formControlName="firstname" />
            </mat-form-field>
          </div>
          <mat-form-field>
            <mat-label>Telefono</mat-label>
            <input matInput formControlName="phone" />
          </mat-form-field>
          }
        </div>
      </form>
      <div class="flex justify-end">
        <button mat-button matStepperPrevious>Atras</button>
        @if(hasRepresentative()){
        <button mat-button matStepperNext>Siguiente</button>
        }
      </div>
    </mat-step>
    @if(hasRepresentative()){
    <mat-step
      [stepControl]="formRepresentative()"
      label="Detalles Representante"
    >
      <form [formGroup]="formRepresentative()" class="py-2">
        <div class="grid grid-cols-3 gap-x-2">
          <mat-form-field>
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="firstname" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Apellido paterno</mat-label>
            <input matInput formControlName="middlename" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Apellido materno</mat-label>
            <input matInput formControlName="lastname" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Dni</mat-label>
            <input matInput formControlName="dni" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Telefono</mat-label>
            <input matInput formControlName="phone" />
          </mat-form-field>
        </div>
      </form>
      <div class="flex justify-end">
        <button mat-button matStepperPrevious>Atras</button>
      </div>
    </mat-step>
    }
  </mat-stepper>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close color="warn">Cancelar</button>
  <button mat-button color="primary" [disabled]="!isFormValid" (click)="save()">
    Guardar
  </button>
</mat-dialog-actions>
