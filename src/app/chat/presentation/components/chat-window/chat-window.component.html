<div class="flex flex-col h-full relative w-full">
  <div
    class="py-2 px-4 flex flex-row justify-between items-center"
    style="background-color: var(--mat-sys-surface-container-high)"
  >
    <div class="flex items-center">
      <div>
        <img class="w-10 h-10 rounded-full" src="images/avatar.png" />
      </div>
      <div class="ml-4">
        <p class="text-lg">
          {{ chat().name | titlecase }}
        </p>
      </div>
    </div>
  </div>
  <div
    class="flex-1 overflow-y-auto px-6 py-2"
    infiniteScroll
    [infiniteScrollDistance]="2"
    [infiniteScrollUpDistance]="0"
    [infiniteScrollThrottle]="50"
    (scrolledUp)="onScrollUp()"
    (scroll)="onScroll()"
    [scrollWindow]="false"
    [alwaysCallback]="true"
    #chatPanel
  >
    @if(isLoadingMoreMessages()){
    <div class="text-center">Cargando mensajes...</div>
    }
    <!-- @if(!isLoadingMoreMessages() && (messages$|async). === 0){
    <div class="text-center py-4">
      Escriba un mensaje para iniciar la conversacion.
    </div>
    }  -->
    @for (item of messagesResource.value(); track $index) {
    <chat-bubble [message]="item" />
    }
  </div>
  @if(!isAtBottom()){
  <button
    matMiniFab
    class="!fixed bottom-24 right-6"
    (click)="scrollToBottom()"
  >
    <mat-icon>arrow_downward</mat-icon>
  </button>
  } @if(newMessagesCount() > 0 && !isAtBottom()){
  <div
    style="background-color: var(--mat-sys-secondary-container)"
    class="absolute bottom-[100px] left-1/2 -translate-x-1/2 text-sm font-medium px-4 py-2 rounded-full cursor-pointer"
    (click)="scrollToBottom()"
  >
    {{ newMessagesCount() }} nuevo{{
      newMessagesCount() > 1 ? "s" : ""
    }}
    mensaje{{ newMessagesCount() > 1 ? "s" : "" }}
  </div>
  }
  <div
    class="flex items-center gap-4 p-4 w-full"
    style="background-color: var(--mat-sys-surface-container-high)"
  >
    <file-chat-selector (onCofirmFiles)="sendFiles($event)" />
    <input
      type="text"
      placeholder="Escribe un mensaje"
      class="flex-1 rounded-xl border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      [(ngModel)]="messageContent"
      (keydown.enter)="sendMessage()"
    />
  </div>
</div>
