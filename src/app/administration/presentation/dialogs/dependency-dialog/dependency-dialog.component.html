<h2 mat-dialog-title>{{ data ? "Editar" : "Crear" }} Dependencia</h2>
<mat-dialog-content>
  <div class="pt-2">
    <form [formGroup]="dependencyForm">
      @if(dependencyForm.get('institucion')){
        <select-search
          title="Institucion"
          placeholder="Seleccione una institucion"
          placeholderLabel="Ingrese el nombre"
          [required]="true"
          [items]="institutions()"
          (onSelect)="selectInstitution($event)"
        />
      }

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 mt-2">
        <div class="sm:col-span-2">
          <mat-form-field>
            <mat-label>Nombre de la dependencia</mat-label>
            <input formControlName="nombre" matInput />
          </mat-form-field>
        </div>
        <mat-form-field>
          <mat-label>Codigo</mat-label>
          <input formControlName="codigo" matInput />
        </mat-form-field>
        <mat-checkbox formControlName="activo"> Habilitado </mat-checkbox>
      </div>

      <div class="flex items-center justify-between mt-4 px-2">
        <span class="text-lg">Areas registradas: ({{ requeriments.length }})</span>
        <button matMiniFab (click)="addRequirement()">
          <mat-icon>add</mat-icon>
      </button>
      </div>

      <div formArrayName="areas" class="overflow-y-auto max-h-64 p-2 mt-2">
        <div *ngFor="let control of requeriments.controls; let i = index">
          <div class="flex gap-x-2 items-center" [formGroupName]="i">
            <div class="w-2/3">
              <mat-form-field>
                <mat-label>Area {{ i + 1 }}</mat-label>
                <input matInput placeholder="Nombre" formControlName="name" />
              </mat-form-field>
            </div>
            <div class="w-1-3">
              <mat-form-field>
                <mat-label>Codigo</mat-label>
                <input
                  matInput
                  type="number"
                  min="1"
                  max="100"
                  formControlName="code"
                />
              </mat-form-field>
            </div>
            <div class="h-12">
              <button mat-icon-button (click)="removeRequirement(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>
        @if(requeriments.length === 0){
        <div class="p-2">Sin areas registradas</div>
        }
      </div>
    </form>
  </div>
</mat-dialog-content>
<div mat-dialog-actions align="end">
  <button mat-button color="warn" mat-dialog-close>Cancelar</button>
  <button
    mat-button
    color="primary"
    [disabled]="dependencyForm.invalid"
    (click)="save()"
  >
    Guardar
  </button>
</div>
