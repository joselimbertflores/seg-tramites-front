<div class="flex flex-col h-full">
  <mat-toolbar color="primary" class="sticky top-0 z-20">
    <button mat-icon-button backButton>
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="ml-4">Detalle</span>
    <span class="flex-1"></span>
    <div class="flex gap-x-2">
      @switch (data()?.status) { @case ("pending") {
      <button mat-icon-button matTooltip="Aceptar" (click)="accept()">
        <mat-icon>done</mat-icon>
      </button>
      <!-- <button mat-icon-button matTooltip="Rechazar" (click)="reject()">
        <mat-icon>block</mat-icon>
      </button> -->
      } @case ("received") {
      <button mat-icon-button matTooltip="Remitir" (click)="send()">
        <mat-icon>send</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Archivar" (click)="archive()">
        <mat-icon>archive</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Hoja de ruta" (click)="generateRouteSheet()">
        <mat-icon>description</mat-icon>
      </button>
      } @default {} }
    </div>
  </mat-toolbar>

  @if(isLoading()) {
  <div class="h-[calc(100vh-128px)] flex items-center justify-center w-full">
    <div class="flex flex-col items-center">
      <mat-spinner />
      <p class="text-lg font-normal mt-4">Cargando contenido</p>
    </div>
  </div>
  } @else {
  <div class="flex-1 overflow-y-auto p-4 space-y-4" @fadeIn>
    @if (data()) {
    <inbox-card [data]="data()!" />
    }
    <div class="border border-slate-300 rounded-xl">
      @if (!isLoading()) {
      <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
        <mat-tab label="Descripcion">
          @switch (data()?.procedure?.group) { @case ("ExternalProcedure") {
          <external-communication [procedure]="external!" />
          } @case ("InternalProcedure") {
          <internal-communication [procedure]="internal" />
          } @case ("ProcurementProcedure") {
          <procurement-communication
            [procedure]="procedure()!"
            [isReceived]="data()?.status === 'received'"
          />
          } @default {
          <p>Type Procedure is not define</p>
          } }
        </mat-tab>
        <mat-tab label="Flujo de trabajo">
          <workflow-list [workflow]="workflow()" />
        </mat-tab>
        <mat-tab label="Flujo de trabajo grafico">
          <workflow-graph [workflow]="workflow()" />
        </mat-tab>
      </mat-tab-group>
      }
    </div>
  </div>
  }
</div>
